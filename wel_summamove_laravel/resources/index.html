<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Summa Move Beheer</title>
  <link rel="stylesheet" href="css/index.css">
</head>
<body>   
    <div id="login-scherm" style="display: none;">
  <h3>Inloggen</h3>
  <input type="email" id="login-email" placeholder="E-mailadres" />
  <input type="password" id="login-wachtwoord" placeholder="Wachtwoord" />
  <button onclick="inloggen()">Inloggen</button>
</div>

    <header class="header-flex">
   <h2> Summa Move Beheer</h2>
<img id="logo" src="img/logo-1861420_1280-Photoroom.png">
<button onclick="logout()">Logout</button>
  </header>


   <div class="layout">
    <div class="sidebar">
      <h2>Menu</h2>
      <ul>
        <li onclick="toonOefeningen()">Oefeningen</li>
        <li onclick="toonGebruikers()">Gebruikers</li>
      </ul>
    </div>

    <div class="main-content exercise-list" id="lijst">
      <!-- Hier komt jouw oefeningenlijst etc -->
    </div>
  </div>


  <button class="add-btn" onclick="voegToe()">+</button>

  <script>
  let oefeningen = []; // Lege array, wordt gevuld via API
  let gebruikers = [];

  
  // Ophalen van oefeningen via API
  async function haalOefeningenOp() {
    try {
      const response = await fetch('http://127.0.0.1:8000/api/oefeningen');
      if (!response.ok) throw new Error('Fout bij ophalen oefeningen');
      oefeningen = await response.json();
      renderOefeningen();
    } catch (error) {
      alert('Kon oefeningen niet laden: ' + error.message);
    }
  }

  // Render oefeningen, nu met objecten (uit API)
  function renderOefeningen() {
    const lijst = document.getElementById("lijst");
    lijst.innerHTML = "";

    oefeningen.forEach(oefening => {
      const div = document.createElement("div");
      div.className = "exercise";
      div.innerHTML = `
        <div>${oefening.naam}</div>
        <div class="actions">
          <button onclick="bewerken(${oefening.id})">‚öôÔ∏è</button>
          <button onclick="deleteOefening(${oefening.id})">üóëÔ∏è</button>
        </div>
      `;
      lijst.appendChild(div);
    });
  }

  // Bewerken - toont formulier, haalt huidige gegevens op
  function bewerken(id) {
    const oefening = oefeningen.find(o => o.id === id);
    if (!oefening) return alert('Oefening niet gevonden');

    const lijst = document.getElementById("lijst");
    lijst.innerHTML = `
      <div class="form-container">
        <button class="back-btn" onclick="haalOefeningenOp()">‚¨Ö Terug</button>
        <h3>Oefening veranderen</h3>
        <label for="titel">Titel:</label>
        <input type="text" id="titel" value="${oefening.naam}">

        <label for="inst-nl">Instructie (NL):</label>
        <textarea id="inst-nl" rows="4" placeholder="Uitleg in het Nederlands...">${oefening.beschrijving_nl ?? ''}</textarea>

        <label for="inst-eng">Instructie (ENG):</label>
        <textarea id="inst-eng" rows="4" placeholder="Instructions in English...">${oefening.beschrijving_en ?? ''}</textarea>

        <button onclick="opslaanBewerking(${id})">Opslaan</button>
      </div>
    `;
  }

  // Opslaan van bewerking (hier kun je fetch POST/PUT toevoegen)
 async function opslaanBewerking(id) {
  const nieuweTitel = document.getElementById("titel").value.trim();
  const instNl = document.getElementById("inst-nl").value.trim();
  const instEng = document.getElementById("inst-eng").value.trim();

  if (!nieuweTitel) {
    alert("Titel mag niet leeg zijn.");
    return;
  }

  try {
    const response = await fetch(`http://127.0.0.1:8000/api/oefeningen/${id}`, {
      method: "PUT",
      headers: {
    'Authorization': 'Bearer ' + token,
  'Content-Type': 'application/json',
  'Accept': 'application/json'
}
,
      body: JSON.stringify({
        naam: nieuweTitel,
        beschrijving_nl: instNl,
        beschrijving_en: instEng
      })
    });

    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.message || "Update mislukt");
    }

    alert(`Oefening "${nieuweTitel}" is succesvol opgeslagen.`);
    haalOefeningenOp(); // herlaad lijst
  } catch (err) {
    alert("Fout bij opslaan: " + err.message);
  }
}


  // Verwijderen gebruiker
  async function deleteUser(userId) {
  try {
    const response = await fetch(`http:127.0.0.1:8000/api/users/${userId}`, {
      method: 'DELETE',
      headers: {
        'Authorization': 'Bearer ' + token,
        'Accept': 'application/json'
      }
    });

    if (!response.ok) {
      throw new Error('Verwijderen mislukt');
    }

    const result = await response.json();
    console.log(result.message); // "Gebruiker verwijderd"
    // eventueel: lijst verversen
  } catch (error) {
    console.error('Fout bij verwijderen:', error);
  }
  haalGebruikersOp();
}
//Verwijderen oefening
async function deleteOefening(id) {


  const response = await fetch(`http://127.0.0.1:8000/api/oefeningen/${id}`, {

    method: 'DELETE',
    headers: {
      'Authorization': 'Bearer ' + token,
      'Accept': 'application/json'
    }
  });

  const result = await response.json();

  if (response.ok) {
    console.log(result.message); // "Oefening verwijderd"
  } else {
    console.error('Fout bij verwijderen:', result);
  }
  haalOefeningenOp();
}



  // Toevoegen nieuwe oefening
  function voegToe() {
    const lijst = document.getElementById("lijst");
    lijst.innerHTML = `
      <div class="form-container">
        <button class="back-btn" onclick="haalOefeningenOp()">‚¨Ö Terug</button>
        <h3>Oefening toevoegen</h3>
        <label for="titel">Titel:</label>
        <input type="text" id="titel" placeholder="Bijv. Burpee">

        <label for="inst-nl">Instructie (NL):</label>
        <textarea id="inst-nl" rows="4" placeholder="Uitleg in het Nederlands..."></textarea>

        <label for="inst-eng">Instructie (ENG):</label>
        <textarea id="inst-eng" rows="4" placeholder="Instructions in English..."></textarea>

        <button onclick="opslaanOefening()">Toevoegen</button>
      </div>
    `;
  }

  // Opslaan nieuwe oefening
 async function opslaanOefening() {
  const titel = document.getElementById("titel").value.trim();
  const instNl = document.getElementById("inst-nl").value.trim();
  const instEng = document.getElementById("inst-eng").value.trim();

  if (!titel) {
    alert("Vul een titel in.");
    return;
  }

  try {
    const response = await fetch('http://127.0.0.1:8000/api/oefeningen', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer ' + token,
        // eventueel: 'Authorization': 'Bearer <token>' als je JWT of sanctum gebruikt
      },
      body: JSON.stringify({
        naam: titel,
        beschrijving_nl: instNl,
        beschrijving_en: instEng
      })
    });

    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.message || 'Toevoegen mislukt');
    }

    const nieuweOefening = await response.json();
    alert(`Oefening "${nieuweOefening.naam}" is succesvol toegevoegd.`);
    haalOefeningenOp(); // herlaad lijst
  } catch (err) {
    alert("Fout bij toevoegen: " + err.message);
  }
}

//logout
  function logout() {
  localStorage.removeItem("token");
  alert("Je bent uitgelogd.");
  location.reload(); // herlaad de pagina om login-scherm te tonen
}


  function renderGebruikers() {
    const lijst = document.getElementById("lijst");
    lijst.innerHTML = "";

    gebruikers.forEach(gebruiker => {
      const div = document.createElement("div");
      div.className = "user";
      div.innerHTML = `
        <div>${gebruiker.name}</div>
        <div class="actions">
          <button onclick="bewerken(${gebruiker.id})">‚öôÔ∏è</button>
          <button onclick="deleteUser(${gebruiker.id})">üóëÔ∏è</button>
        </div>
      `;
      lijst.appendChild(div);
    });
  }

async function haalGebruikersOp() {
    try {
      const response = await fetch('http://127.0.0.1:8000/api/users');
      if (!response.ok) throw new Error('Fout bij ophalen gebruikers');
      gebruikers = await response.json();
      renderGebruikers();
    } catch (error) {
      alert('Kon oefeningen niet laden: ' + error.message);
    }
  }

  // Toon oefeningen (haal eerst op)
  function toonOefeningen() {
    haalOefeningenOp();
  }

  // Toon gebruikers (fictief)
  function toonGebruikers() {
    haalGebruikersOp();
  }

  // Initialisatie
  toonOefeningen();
  // Initialisatie
const token = localStorage.getItem("token");

if (token) {
  haalOefeningenOp();
} else {
  document.getElementById("login-scherm").style.display = "block";
}

// inloggen
  async function inloggen() {
  const email = document.getElementById("login-email").value.trim();
  const wachtwoord = document.getElementById("login-wachtwoord").value;

  if (!email || !wachtwoord) {
    return alert("Vul zowel e-mailadres als wachtwoord in.");
  }

  try {
    const response = await fetch("http://127.0.0.1:8000/api/login", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Accept": "application/json",
      },
      body: JSON.stringify({
        email: email,
        password: wachtwoord,
      }),
    });

    const data = await response.json();

    if (!response.ok) {
      throw new Error(data.message || "Login mislukt");
    }

    localStorage.setItem("token", data.access_token);
    console.log(data.access_token);

    alert("Succesvol ingelogd!");


    document.getElementById("login-scherm").style.display = "none";
    haalOefeningenOp();
  } catch (err) {
    alert("Fout bij inloggen: " + err.message);
  }
}

  
</script>
</body>
</html>
